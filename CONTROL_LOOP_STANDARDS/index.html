<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CONTROL_LOOP_STANDARDS" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Control Loop Standards | FRC 190 Code Standards</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://team-190.github.io/190-Robot-Code-Standards/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://team-190.github.io/190-Robot-Code-Standards/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://team-190.github.io/190-Robot-Code-Standards/CONTROL_LOOP_STANDARDS"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Control Loop Standards | FRC 190 Code Standards"><meta data-rh="true" name="description" content="Feedback and PID Control"><meta data-rh="true" property="og:description" content="Feedback and PID Control"><link data-rh="true" rel="canonical" href="https://team-190.github.io/190-Robot-Code-Standards/CONTROL_LOOP_STANDARDS"><link data-rh="true" rel="alternate" href="https://team-190.github.io/190-Robot-Code-Standards/CONTROL_LOOP_STANDARDS" hreflang="en"><link data-rh="true" rel="alternate" href="https://team-190.github.io/190-Robot-Code-Standards/CONTROL_LOOP_STANDARDS" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-no6+qq8FyDyUjWzWW0sr2mFHOaPtZpvUolqk2vh5Tdt3L+4anWWNWAo2F3Q9Ja5g" crossorigin="anonymous"><link rel="stylesheet" href="/190-Robot-Code-Standards/assets/css/styles.38b3093a.css">
<script src="/190-Robot-Code-Standards/assets/js/runtime~main.e169cf7f.js" defer="defer"></script>
<script src="/190-Robot-Code-Standards/assets/js/main.0a9095ed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/190-Robot-Code-Standards/"><div class="navbar__logo"><img src="/190-Robot-Code-Standards/img/team190_hat_FINAL2.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/190-Robot-Code-Standards/img/team190_hat_FINAL2.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">190 Code Standard</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Team-190/190-Robot-Code-Standards" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/">FRC 190 Code Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/GLOBAL_STANDARDS">Global Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/ROBOT_CODE_OVERVIEW">FRC Code Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/ADVANTAGEKIT_STANDARDS">AdvantageKit Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/SUBSYSTEM_STANDARDS">Subsystem Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/COMMANDS_STANDARDS">Command Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/190-Robot-Code-Standards/CONTROL_LOOP_STANDARDS">Control Loop Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/LOGGING_STANDARDS">Logger Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/ROBOTSTATE_STANDARDS">Robot State Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/190-Robot-Code-Standards/CONSTANTS_STANDARDS">Constants Standards</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/190-Robot-Code-Standards/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Control Loop Standards</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Control Loop Standards</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feedback-and-pid-control">Feedback and PID Control<a href="#feedback-and-pid-control" class="hash-link" aria-label="Direct link to Feedback and PID Control" title="Direct link to Feedback and PID Control">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-terms">Key Terms:<a href="#key-terms" class="hash-link" aria-label="Direct link to Key Terms:" title="Direct link to Key Terms:">​</a></h3>
<ul>
<li>Process variable: The part of the robot being controlled. (ex. Arm position, gyro angle, etc).</li>
<li>Setpoint: The desired value of the process variable.</li>
<li>Output: The current value of the process variable.</li>
<li>Error: setpoint - output, in other words, the difference between where the mechanism is and where it should be.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>ALL EXAMPLE CODE IN THIS DOCUMENT USE WPILIB CLASSES TO IMPLEMENT CONTROL LOOPS. FOR ACTUAL HARDWARE, IT IS PREFERRED TO RUN CONTROL LOOPS ON THE MOTOR CONTROLLERS.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feedback-control">Feedback Control<a href="#feedback-control" class="hash-link" aria-label="Direct link to Feedback Control" title="Direct link to Feedback Control">​</a></h3>
<p>Feedback control is a process by which the robot controls its mechanisms while referencing input data from its sensors. With most mechanisms, the goal is to reach the setpoint as fast and accurately as possible. In other words, it tries to reduce the error to 0.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pid-controllers">PID controllers<a href="#pid-controllers" class="hash-link" aria-label="Direct link to PID controllers" title="Direct link to PID controllers">​</a></h3>
<p>The most common form of feedback control is a <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/introduction-to-pid.html#introduction-to-pid" target="_blank" rel="noopener noreferrer">PID controller</a>. PID controllers consist of 3 gains which influence the behavior of different parts of the mechanism.</p>
<p><a href="https://github.com/wpilibsuite/allwpilib" target="_blank" rel="noopener noreferrer">WPILib</a> has a built in <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/pidcontroller.html" target="_blank" rel="noopener noreferrer">PID Controller class</a> that is used when implementing feedback control.</p>
<p>Example: PID controller to aim the robot at a target</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PIDController aimController =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new PIDController(autoAimKP.get(), 0.0, autoAimKD.get(), Constants.LOOP_PERIOD_SECS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aimController.enableContinuousInput(-Math.PI, Math.PI);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aimController.setTolerance(Units.degreesToRadians(1.0));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aimController.calculate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    measuredGyroAngle.getRadians(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targetGyroAngle.get().getRadians())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The controller calculates the next control output which is used in the calculation of the robot&#x27;s speed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feedforward-control">Feedforward Control<a href="#feedforward-control" class="hash-link" aria-label="Direct link to Feedforward Control" title="Direct link to Feedforward Control">​</a></h2>
<p>In the previous example, the <code>autoAimKI</code> term is 0. The Ki term, or the integral term of a PID controller, corrects for <a href="https://www.sciencedirect.com/topics/engineering/steady-state-error" target="_blank" rel="noopener noreferrer">steady state error</a> in the system, which is when the controller can&#x27;t reach the setpoint.</p>
<p><img decoding="async" loading="lazy" alt="Steady State Error" src="/190-Robot-Code-Standards/assets/images/Steady_State_Error-709a69c96a424f4af5199f3e1cd03f49.jpg" width="1280" height="720" class="img_ev3q"></p>
<p>The Integral term scales the output based on the total error over time. Meaning, as time progresses, if the output of the controller doesn&#x27;t reach the setpoint, the Integral term will eventually rise to a value where the output reaches the setpoint.</p>
<p>The Integral term of a PID controller is rarely used because:</p>
<ul>
<li>It is reactive, meaning it reacts to the steady state error, slowing down the progression of the error to the setpoint.</li>
<li>It is prone to <a href="https://en.wikipedia.org/wiki/Integral_windup" target="_blank" rel="noopener noreferrer">Integral Windup</a>, which is when the mechanism is somehow impeded from reaching the setpoint, which causes the Integral term to rise high enough to cause the output to be too fast.</li>
</ul>
<p>When dealing with steady state error in FRC, most use a <a href="https://en.wikipedia.org/wiki/Feed_forward_(control)" target="_blank" rel="noopener noreferrer">Feedforward</a>, which predicts what the steady state error will be based on empircal measurements or theoretical system dynamics. In practice, this often means applying a constant output to a mechanism to overcome the force of gravity or static friction of the system.</p>
<p>WPILib has multiple <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/feedforward.html" target="_blank" rel="noopener noreferrer">Feedforward classes</a> which are used for implementing Feedforward control.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="combining-feedback-and-feedforward-control">Combining Feedback and Feedforward control<a href="#combining-feedback-and-feedforward-control" class="hash-link" aria-label="Direct link to Combining Feedback and Feedforward control" title="Direct link to Combining Feedback and Feedforward control">​</a></h2>
<p>When controlling a mechanism, it is often necessary to use both a Feedforward and Feedback controller to account for steady state error like gravity or static friction, while still controlling the mechanism to the setpoint. This is done by simply adding the PID controller output to the feedforward output.</p>
<p>Example: Feedforward and PID controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">leftFeedback = new PIDController(KP.get(), 0.0, KD.get(), Constants.LOOP_PERIOD_SECS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rightFeedback = new PIDController(KP.get(), 0.0, KD.get(), Constants.LOOP_PERIOD_SECS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leftFeedforward = new SimpleMotorFeedforward(KS_LEFT.get(), KV_LEFT.get(), KA_LEFT.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rightFeedforward = new SimpleMotorFeedforward(KS_RIGHT.get(), KV_RIGHT.get(), KA_RIGHT.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">leftFeedback.setSetpoint(leftSetpoint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rightFeedback.setSetpoint(rightSetpoint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io.setLeftVoltage(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leftFeedforward.calculate(leftSetpoint) + leftFeedback.calculate(inputs.leftVelocityRadPerSec));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io.setRightVoltage(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rightFeedforward.calculate(rightSetpoint)+ rightFeedback.calculate(inputs.rightVelocityRadPerSec));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pid-control-with-motion-profiling">PID Control with Motion Profiling<a href="#pid-control-with-motion-profiling" class="hash-link" aria-label="Direct link to PID Control with Motion Profiling" title="Direct link to PID Control with Motion Profiling">​</a></h2>
<p>In FRC, it is often necessary to limit the speed or acceleration of a mechanism. This can be done with a <a href="https://www.motioncontroltips.com/what-is-a-motion-profile/" target="_blank" rel="noopener noreferrer">Motion Profile</a>. Motion profiles use a set of parameters, such as max velocity and acceleration to generate a series of setpoints which a controller can follow. This serves to artificially limit the velocity and/or acceleration of a system.</p>
<p><img decoding="async" loading="lazy" alt="Motion Profile" src="/190-Robot-Code-Standards/assets/images/Motion_Profile-134daf4741cd7c4131b87554937e828b.png" width="620" height="554" class="img_ev3q"></p>
<p>WPILib has a <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/profiled-pidcontroller.html" target="_blank" rel="noopener noreferrer">ProfiledPIDController class</a> which handles the setpoint generation automatically.</p>
<p>Example: Profiled PID controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ProfiledPIDController profiledFeedback =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new ProfiledPIDController(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            KP.get(), 0.0, KD.get(), new Constraints(MAX_VELOCITY.get(), MAX_ACCELERATION.get()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double position =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MathUtil.clamp(positionRad + angleOffset, MIN_POSITION.get(), MAX_POSITION.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiledFeedback.setGoal(position);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="standards">Standards<a href="#standards" class="hash-link" aria-label="Direct link to Standards" title="Direct link to Standards">​</a></h2>
<p>The standards for control loops are as follows:</p>
<ul>
<li>All gains should be stored as a record of <a href="/190-Robot-Code-Standards/LOGGING_STANDARDS"><code>LoggedTunableNumber</code></a> objects in the appropriate subsystem&#x27;s constants file.<!-- -->
<ul>
<li>Example:</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public record Gains(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber kp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber kd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber ks,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber kg,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber kv) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public record Constraints(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber maxVelocityRadiansPerSecond,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber maxAccelerationRadiansPerSecondSqaured,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggedTunableNumber goalToleranceRadians) {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Make sure to initialize defaults <a href="/190-Robot-Code-Standards/CONSTANTS_STANDARDS">appropriately</a>.</li>
</ul>
</li>
<li>For actual hardware, all control loops should be run onboard the motorcontroller. See Pheonix 6/Pro documentation for more details.</li>
<li>For simulated hardware, all control loops should use WPILib classes.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tuning-controller-gains">Tuning Controller Gains<a href="#tuning-controller-gains" class="hash-link" aria-label="Direct link to Tuning Controller Gains" title="Direct link to Tuning Controller Gains">​</a></h2>
<p>Figuring out what the value of each gain should be can be challenging, but with a good tuning process, it can be done methodically.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-tuning">Manual Tuning<a href="#manual-tuning" class="hash-link" aria-label="Direct link to Manual Tuning" title="Direct link to Manual Tuning">​</a></h3>
<p>While tuning controllers manually, it is important to consider the units of the process variable. Consider an example of a single swerve wheel rotation controlled by raw voltage. The unit for the position of the wheel will be radians, and the unit for velocity is radians per second. Swerve wheel rotation works by wrapping the value of the rotation to between (-3.14, 3.14) radians, meaning the maximum error the wheel can experience is 3.14 radians from the setpoint. The maximum voltage the battery can supply a motor is 12 V. Armed with this information, it is plausible to estimate the order of magnitude that Kp and Kd should be.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pid-controller">PID Controller<a href="#pid-controller" class="hash-link" aria-label="Direct link to PID Controller" title="Direct link to PID Controller">​</a></h4>
<ol>
<li>Set Kd and Ki to 0.</li>
<li>Increase Kp from 0 by small increments until the mechanism starts oscillating around the setpoint.</li>
<li>Slowly increase Kd until the robot stops oscillating.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li>If the robot is jittery when tuning, reduce Kd</li>
<li>If the robot experiences steady state error, consider implementing a Feedforward.</li>
<li>A PID controller is tuned well if the output gets to the setpoint quickly without oscillating (green line):
<img decoding="async" loading="lazy" alt="PID Diagram" src="/190-Robot-Code-Standards/assets/images/pid-overshoot-undershoop-oscillation-diagram-explain-5859add3b0b5a207ba90765872f7f78d.jpg" width="674" height="600" class="img_ev3q"></li>
</ul></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pid-controller-with-motion-profile">PID Controller with Motion Profile<a href="#pid-controller-with-motion-profile" class="hash-link" aria-label="Direct link to PID Controller with Motion Profile" title="Direct link to PID Controller with Motion Profile">​</a></h4>
<ol>
<li>Set Kp Ki and Kd to 0.</li>
<li>Set the maximum velocity and acceleration for the motion profile very low.</li>
<li>Tune the PID controller until the output tracks the setpoint well.</li>
<li>Continue this process by incrementing maximum velocity and acceleration and tuning PID until the maximum velocity and acceleration are reasonable.</li>
</ol>
<ul>
<li>NOTES:<!-- -->
<ul>
<li>A motion profiled PID controller is tuned well when the output &quot;tracks&quot; the profile setpoints well. This means that the output should closely follow the shape of the motion profile.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sysid-tuning"><a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/system-identification/introduction.html" target="_blank" rel="noopener noreferrer">SysID Tuning</a><a href="#sysid-tuning" class="hash-link" aria-label="Direct link to sysid-tuning" title="Direct link to sysid-tuning">​</a></h3>
<p>Fortunately, WPILib offers a relatively simple way of empirically measuring what the optimal feedforward gains should be. The SysID tutorial goes over what is needed to perform this task, however there are some standards to mention:</p>
<ul>
<li><code>SysIDRoutine</code> code should be declared as a member variable of its subsystem:<!-- -->
<ul>
<li>Example:</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private final SysIdRoutine sysIdRoutine =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new SysIdRoutine(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new SysIdRoutine.Config(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Volts.of(SubsystemConstants.RAMP_RATE_VOLTAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .per(Seconds.of(SubsystemConstants.RAMP_RATE_SECONDS)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Volts.of(SubsystemConstants.STEP_VOLTAGE),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Seconds.of(SubsystemConstants.SYSID_TIMEOUT),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (state) -&gt; Logger.recordOutput(&quot;Subsystem/SysID State&quot;, state.toString())),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new SysIdRoutine.Mechanism((volts) -&gt; setVoltage(volts.in(Volts)), null, this));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>The command to actually run SysID will be written as a command factory in the subsystem as follows:<!-- -->
<ul>
<li>Example:</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public Command runSysId() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Commands.sequence(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysIdRoutine.quasistatic(Direction.kForward),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Commands.waitSeconds(SubsystemConstants.SYSID_DELAY),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysIdRoutine.quasistatic(Direction.kReverse),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Commands.waitSeconds(SubsystemConstants.SYSID_DELAY),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysIdRoutine.dynamic(Direction.kForward),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Commands.waitSeconds(SubsystemConstants.SYSID_DELAY),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sysIdRoutine.dynamic(Direction.kReverse));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>All SysID Commands should be added to the list of autonomous modes if the robot is in <a href="/190-Robot-Code-Standards/LOGGING_STANDARDS">Tuning Mode</a></li>
</ul>
<p>Example: Autonomous chooser with shooter and drive characterization routines</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (Constants.TUNING_MODE) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autoChooser.addOption(&quot;Shooter SysID&quot;, shooter.runSysId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autoChooser.addOption(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;Drive Quasistatic Forward&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DriveCommands.runSysIdQuasistatic(drive, Direction.kForward));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autoChooser.addOption(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;Drive Quasistatic Reverse&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DriveCommands.runSysIdQuasistatic(drive, Direction.kReverse));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autoChooser.addOption(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;Drive Dynamic Forward&quot;, DriveCommands.runSysIdDynamic(drive, Direction.kForward));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autoChooser.addOption(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;Drive Dynamic Reverse&quot;, DriveCommands.runSysIdDynamic(drive, Direction.kReverse));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/190-Robot-Code-Standards/COMMANDS_STANDARDS"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Command Standards</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/190-Robot-Code-Standards/LOGGING_STANDARDS"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logger Standards</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#feedback-and-pid-control" class="table-of-contents__link toc-highlight">Feedback and PID Control</a><ul><li><a href="#key-terms" class="table-of-contents__link toc-highlight">Key Terms:</a></li><li><a href="#feedback-control" class="table-of-contents__link toc-highlight">Feedback Control</a></li><li><a href="#pid-controllers" class="table-of-contents__link toc-highlight">PID controllers</a></li></ul></li><li><a href="#feedforward-control" class="table-of-contents__link toc-highlight">Feedforward Control</a></li><li><a href="#combining-feedback-and-feedforward-control" class="table-of-contents__link toc-highlight">Combining Feedback and Feedforward control</a></li><li><a href="#pid-control-with-motion-profiling" class="table-of-contents__link toc-highlight">PID Control with Motion Profiling</a></li><li><a href="#standards" class="table-of-contents__link toc-highlight">Standards</a></li><li><a href="#tuning-controller-gains" class="table-of-contents__link toc-highlight">Tuning Controller Gains</a><ul><li><a href="#manual-tuning" class="table-of-contents__link toc-highlight">Manual Tuning</a></li><li><a href="#sysid-tuning" class="table-of-contents__link toc-highlight">SysID Tuning</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>